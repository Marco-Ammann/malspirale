<header class="app-header" [class.scrolled]="isScrolled">
  <div class="header-inner">
    <div class="brand">
      <h1><a routerLink="/" (click)="closeAllMenus()">Malspirale</a></h1>
    </div>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav" aria-label="Hauptnavigation">
      <a routerLink="/home" routerLinkActive="active" (click)="closeAllMenus()">Home</a>
      
      <!-- Gallery Dropdown -->
      <div class="dropdown">
        <button class="dropdown-toggle" (click)="toggleDropdown('gallery')" [attr.aria-expanded]="galleryDropdownOpen">
          Galerie <span class="material-icons">arrow_drop_down</span>
        </button>
        <div class="dropdown-menu" [class.show]="galleryDropdownOpen">
          <a routerLink="/gallery" routerLinkActive="active">Kunstwerke</a>
          <a routerLink="/gallery/photographer" routerLinkActive="active">Fotografie</a>
        </div>
      </div>
      
      <a routerLink="/workshops" routerLinkActive="active" (click)="closeAllMenus()">Workshops</a>
      <a routerLink="/contact" routerLinkActive="active" (click)="closeAllMenus()">Kontakt</a>
      <a routerLink="/about" routerLinkActive="active" (click)="closeAllMenus()">Über mich</a>

      <!-- Dropdown for Philosophy -->
      <div class="dropdown">
        <button class="dropdown-toggle" (click)="toggleDropdown('philosophy')" [attr.aria-expanded]="philosophyDropdownOpen">
          Philosophie <span class="material-icons">arrow_drop_down</span>
        </button>
        <div class="dropdown-menu" [class.show]="philosophyDropdownOpen">
          <a routerLink="/philosophie/farben" routerLinkActive="active">Farben</a>
          <a routerLink="/philosophie/geschichten" routerLinkActive="active">Geschichten</a>
          <a routerLink="/philosophie/resonance-farben" routerLinkActive="active">Resonance Colors</a>
        </div>
      </div>

      <!-- User Menu -->
      <div class="dropdown user-menu" [class.open]="userDropdownOpen">
        <button class="dropdown-toggle" (click)="toggleDropdown('user')" aria-haspopup="true" [attr.aria-expanded]="userDropdownOpen">
          <span class="material-icons user-icon">account_circle</span>
          <span class="material-icons">{{ userDropdownOpen ? 'expand_less' : 'expand_more' }}</span>
        </button>
        <div class="dropdown-menu" [class.show]="userDropdownOpen" role="menu" aria-label="Benutzermenü">
          <a *ngIf="!isLoggedIn" routerLink="/login" routerLinkActive="active" (click)="closeAllMenus()" role="menuitem">Login</a>
          <a *ngIf="isLoggedIn && isAdmin" routerLink="/admin" role="menuitem" (click)="closeAllMenus()">Admin</a>
          <a *ngIf="isLoggedIn" routerLink="/profile" role="menuitem" (click)="closeAllMenus()">Profil</a>
          <a *ngIf="isLoggedIn" href="javascript:void(0)" (click)="logout(); closeAllMenus()" role="menuitem">Logout</a>
        </div>
      </div>
    </nav>

    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" (click)="toggleMobileMenu()" aria-label="Menü öffnen" [attr.aria-expanded]="mobileMenuOpen">
      <span class="material-icons menu-icon">menu</span>
    </button>
  </div>

  <!-- Backdrop-Overlay und Off-Canvas Mobile Navigation -->
  <div class="mobile-nav-backdrop" [class.open]="mobileMenuOpen" (click)="closeMobileMenu()">
    <nav class="mobile-nav-overlay" [class.open]="mobileMenuOpen" (click)="$event.stopPropagation()" aria-label="Mobile Navigation">
      <!-- Close Button -->
      <button class="close" (click)="toggleMobileMenu()" aria-label="Menü schließen">
        <span class="material-icons">close</span>
      </button>
      <div class="mobile-nav-content">
        <a routerLink="/home" routerLinkActive="active" (click)="closeAllMenus()">Home</a>
        
        <!-- Mobile Gallery Dropdown -->
        <div class="dropdown">
          <div class="dropdown-toggle" (click)="toggleSubmenu('gallery')">
            Galerie
            <span class="material-icons">{{ isSubmenuOpen('gallery') ? 'expand_less' : 'expand_more' }}</span>
          </div>
          <div class="submenu" [class.open]="isSubmenuOpen('gallery')">
            <a routerLink="/gallery" routerLinkActive="active" (click)="closeAllMenus()">Kunstwerke</a>
            <a routerLink="/gallery/photographer" routerLinkActive="active" (click)="closeAllMenus()">Fotografie</a>
          </div>
        </div>
        
        <a routerLink="/workshops" routerLinkActive="active" (click)="closeAllMenus()">Workshops</a>
        <a routerLink="/contact" routerLinkActive="active" (click)="closeAllMenus()">Kontakt</a>
        <a routerLink="/about" routerLinkActive="active" (click)="closeAllMenus()">Über mich</a>
        
        <!-- Mobile Dropdown for Philosophy -->
        <div class="dropdown">
          <div class="dropdown-toggle" (click)="toggleSubmenu('philosophy')">
            Philosophie
            <span class="material-icons">{{ isSubmenuOpen('philosophy') ? 'expand_less' : 'expand_more' }}</span>
          </div>
          <div class="submenu" [class.open]="isSubmenuOpen('philosophy')">
            <a routerLink="/philosophie/farben" routerLinkActive="active" (click)="closeAllMenus()">Farben</a>
            <a routerLink="/philosophie/geschichten" routerLinkActive="active" (click)="closeAllMenus()">Geschichten</a>
            <a routerLink="/philosophie/resonance-farben" routerLinkActive="active" (click)="closeAllMenus()">Resonance Colors</a>
          </div>
        </div>
        
        <!-- Mobile User Menu -->
        <ng-container *ngIf="isLoggedIn; else loginButton">
          <div class="dropdown" [class.open]="isSubmenuOpen('user')">
            <div class="dropdown-toggle" (click)="toggleSubmenu('user')">
              Mein Konto
              <span class="material-icons">{{ isSubmenuOpen('user') ? 'expand_less' : 'expand_more' }}</span>
            </div>
            <div class="submenu" [class.open]="isSubmenuOpen('user')">
              <a *ngIf="isAdmin" routerLink="/admin" routerLinkActive="active" (click)="closeMobileMenu()">Admin</a>
              <a routerLink="/profile" routerLinkActive="active" (click)="closeMobileMenu()">Profil</a>
              <a href="javascript:void(0)" (click)="logout(); closeMobileMenu()">Logout</a>
            </div>
          </div>
        </ng-container>
        <ng-template #loginButton>
          <a routerLink="/login" routerLinkActive="active" (click)="closeMobileMenu()">Login</a>
        </ng-template>
      </div>
    </nav>
  </div>
</header>